"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}/**
 * @author      OA Wu <comdan66@gmail.com>
 * @copyright   Copyright (c) 2015 - 2021, Lalilo
 * @license     http://opensource.org/licenses/MIT  MIT License
 * @link        https://www.ioa.tw/
 */Load.init({data:{identifier:"friend",index:0,users:null,total:null,nextId:0,recommends:[],search:{v:"",t:null,i:!1}},mounted:function mounted(){var a=this;this.reload(),API.GET("friend/recommend").auth().done(function(b){return a.recommends=b}).send(),API.GET("friend/total").auth().done(function(b){return a.total=b}).send()},computed:{},methods:{keyup:function keyup(){var a=this;this.search.t=setTimeout(function(){return a.loadData(a.search.i=!0,a.nextId=0,a.users=[])},500,clearTimeout(this.search.t))},reload:function reload(){this.users=null,this.nextId=0,this.loadData()},loadData:function loadData(){var a=this;API.GET("friend",{nextId:this.nextId,keyword:this.search.v,type:["follow","fan","review"][this.index]}).auth().done(function(b){var c,d=b.users,e=b.nextId;a.search.i=!1,null===a.users?a.users=d:(c=a.users).push.apply(c,_toConsumableArray(d)),a.nextId=e}).send()},follow:function follow(a,b){var c=this;API.POST("friend",{goalId:a.id,status:b?"yes":"no"}).auth().done(function(){var d=c.recommends.indexOf(a);-1==d||c.recommends.splice(d,1),b&&Toastr.success("\u5DF2\u7D93\u8DDF"+a.name+"\u63D0\u51FA\u8FFD\u8E64\u7533\u8ACB\u56C9\uFF01")}).fail(function(a){return Toastr.failure(a)}).send()},setFriend:function setFriend(a,b){var c=this;API.PUT("friend/"+a.id+"/review2",{isEnable:b?"yes":"no"}).auth().done(function(){var d=c.users.indexOf(a);-1==d||c.users.splice(d,1),b&&Toastr.success("\u5DF2\u7D93\u540C\u610F"+a.name+"\u7684\u8FFD\u8E64\u56C9\uFF01")}).fail(function(a){return Toastr.failure(a)}).send()}},template:El.render("\n    layout => :page=this\n\n      span.title => :slot='nav'   *text='\u6211\u7684\u53CB\u8ABC'\n      \n      template => *if=recommends.length\n        span.rheader => *text='\u70BA\u4F60\u63A8\u85A6'\n        div.recommends\n          label.recommend => *for=recommend in recommends   :key=recommend.id\n            figure => :style={backgroundImage: 'url(' + (recommend.avatar || '/img/default_s.png') + ')'}\n            b => *text=recommend.name\n            span => *text=recommend.follows ? '\u6709 ' + numFormat(recommend.follows) + ' \u500B\u7C89\u7D72' : '\u6C92\u6709\u7C89\u7D72'\n            label.follow => *text='\u8FFD\u8E64'   @click=follow(recommend, true)\n            label._icon_b.close =>    @click=follow(recommend, false)\n\n      div._segmented => n=3   :i=index\n        label._item => *text='\u8FFD\u8E64\u4E2D'   @click=_ => reload(index=0)   :n=total?total.follow:0\n        label._item => *text='\u7C89\u7D72\u5011'   @click=_ => reload(index=1)   :n=total?total.fan:0\n        label._item => *text='\u672A\u5BE9\u6838'   @click=_ => reload(index=2)   :n=total?total.review:0\n\n      form._form._tableview.__group.search => header=\u5FEB\u901F\u641C\u5C0B\n        input._input => type=input   :placeholder='\u540D\u7A31\u95DC\u9375\u5B57\u641C\u5C0B\u2026'   *model.trim=search.v   @keyup=keyup   :readonly=search.i\n\n      div.load => *if=users===null   *text='\u8B80\u53D6\u4E2D\uFF0C\u8ACB\u7A0D\u5019\u2026'\n\n      template => *else\n        div.empty => *if=!users.length   *text='\u76EE\u524D\u6C92\u6709\u4EFB\u4F55\u7684\u8CC7\u6599\u3002'\n        template => *else\n\n          div._tableview.__group => *if=users.length\n            label._item.user => *for=user in users   :key=user.id   :class={__arrow: index < 2}   @click=index < 2 && Alert('\u6B64\u529F\u80FD\u9084\u6C92\u5B8C\u6210\u5594\uFF01').button('\u4E86\u89E3', alert => alert.dismiss()).present()\n              figure => :style={backgroundImage: 'url(' + (user.avatar || '/img/default_s.png') + ')'}\n              div\n                b.name => *text=user.name\n                span.ago => *text=user.follows ? '\u6709 ' + numFormat(user.follows) + ' \u500B\u7C89\u7D72' : ''\n                div.btns => *if=index==2\n                  label._point._center => *text='\u78BA\u8A8D'   @click=e => setFriend(user, true)\n                  label._point._center => *text='\u5FFD\u7565'   @click=e => setFriend(user, false)\n\n          div._tableview.__group\n            label._item._pointer._center.__link => *text='\u8F09\u5165\u66F4\u591A\u2026'   @click=loadData   *if=nextId\n")});