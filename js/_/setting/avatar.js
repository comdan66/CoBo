"use strict";/**
 * @author      OA Wu <comdan66@gmail.com>
 * @copyright   Copyright (c) 2015 - 2021, Lalilo
 * @license     http://opensource.org/licenses/MIT  MIT License
 * @link        https://www.ioa.tw/
 */Vue.component("avatar",{data:function data(){return{messages:[],url:{ori:Auth.user.avatar,val:""},file:null,hover:!1,choice:!1,allows:["image/jpeg","image/jpg","image/png"]}},methods:{failure:function failure(a){return this.messages=a.length?[{type:"failure",contents:a}]:[]},dragover:function dragover(a){this.choice||(a.stopPropagation(),a.preventDefault(),this.hover=!0)},dragleave:function dragleave(){this.hover=!1},drop:function drop(){this.hover=!1},change:function change(a){var b=this;if(!this.choice){this.failure([],this.choice=!0,this.hover=!1,this.file=null,this.url.val="");var c=Array.from(a.target.files||a.dataTransfer.files);c.length&&this.allows.includes(c[0].type)?ImageThumbnail(this.file=c[0],1024,function(a){b.choice=!1,b.url.val=a}):this.choice=!1}},upload:function upload(){var a=this;Alert().loading("\u4E0A\u50B3\u4E2D\uFF0C\u8ACB\u7A0D\u5019\u2026").present(function(b){var c=new FormData;c.append("avatar",a.file),API.POST("auth/avatar",c,{processData:!1,contentType:!1,xhr:function xhr(a){return a=$.ajaxSettings.xhr(),a.upload.onprogress=function(a){return b.loading("\u4E0A\u50B3\u4E2D\uFF0C\u8ACB\u7A0D\u5019\u2026("+Math.floor(100*(a.loaded/a.total))+"%)")},a}}).auth().done(function(b){var c=b.token;return a.$emit("done",Auth.logout().login(c,!0))}).fail(a.failure).after(function(){return b.dismiss()}).send()})}},template:El.render("\n    div.avatar\n      form-messages => :messages=messages\n\n      label.box => :class={ hover: hover, choice: choice }   @dragover=dragover   @dragleave=dragleave   @drop=drop\n        input => type=file   accept=image/*   @change=change\n\n        figure => *if=url   :style={backgroundImage: 'url(' + (url.val || url.ori) + ')'}\n        \n        span => *text='\u8ACB\u9078\u64C7\u982D\u50CF\u2026'\n      \n      label.upload => *if=file   *text='\u78BA\u5B9A\u4E0A\u50B3'   @click=upload\n  ")});